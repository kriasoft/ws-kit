import{v as t,a as r,f as o,l as i}from"./chunks/framework.xlyBlKIJ.js";const h=JSON.parse('{"title":"WS-Kit Patterns — Invariants","description":"","frontmatter":{},"headers":[],"relativePath":"invariants.md","filePath":"invariants.md","lastUpdated":1762079697000}'),a={name:"invariants.md"};function n(s,e,d,l,c,p){return o(),r("div",null,[...e[0]||(e[0]=[i('<h1 id="ws-kit-patterns-—-invariants" tabindex="-1">WS-Kit Patterns — Invariants <a class="header-anchor" href="#ws-kit-patterns-—-invariants" aria-label="Permalink to “WS-Kit Patterns — Invariants”">​</a></h1><p>Canonical rules and names for the shipped application patterns: state channels, flow control, and delta sync.</p><h2 id="canonical-field-names" tabindex="-1">Canonical Field Names <a class="header-anchor" href="#canonical-field-names" aria-label="Permalink to “Canonical Field Names”">​</a></h2><ul><li><strong><code>seq</code></strong> — immutable sequence number (event ID, not revision)</li><li><strong><code>rev</code></strong> — snapshot revision or version number (for state snapshots, distinct from seq)</li><li><strong><code>resumeFrom</code></strong> — checkpoint for reconnection recovery</li><li><strong><code>policy</code></strong> — backpressure strategy identifier (e.g., &quot;drop-oldest&quot;, &quot;drop-new&quot;)</li><li><strong><code>retryAfterMs</code></strong> — server hint: milliseconds before retry is safe</li><li><strong><code>queueDepth</code></strong> — current queue size (pattern-specific: used in flow control)</li><li><strong><code>bufferFirstRev</code></strong> — oldest revision still available in the operation buffer (pattern-specific: used in delta sync)</li></ul><p>Each pattern may introduce additional helper fields to support error recovery. For example, state channels uses:</p><ul><li><code>expectedSeq</code> (diagnostic: first missing client seq)</li><li><code>receivedSeq</code> (diagnostic: what client sent)</li><li><code>resumeFrom</code> (recovery cursor: first missing server seq)</li></ul><p>Refer to pattern documentation for full field lists and semantics.</p><h2 id="do" tabindex="-1">DO <a class="header-anchor" href="#do" aria-label="Permalink to “DO”">​</a></h2><ul><li>Use <code>seq</code> as event identity; never increment on retry</li><li>Validate <code>seq</code> ordering server-side before applying</li><li>Provide fixtures for all documented scenarios (happy path plus at least one failure)</li><li>Version schemas independently of WS-Kit releases (<code>1.0.0</code> format)</li><li>Emit <code>retryAfterMs</code> hints instead of hard-coded retry delays</li></ul><h2 id="don-t" tabindex="-1">DON&#39;T <a class="header-anchor" href="#don-t" aria-label="Permalink to “DON&#39;T”">​</a></h2><ul><li>Reuse <code>id</code> for sequencing (ambiguous with message ID)</li><li>Treat <code>seq</code> as revision (different semantics)</li><li>Assume idempotent retry without explicit <code>seq</code> dedup</li><li>Hard-code error recovery logic (send retry hints instead)</li><li>Mix schema versions in test fixtures</li><li>Bypass schema validation before payload processing</li></ul><h2 id="error-codes" tabindex="-1">Error Codes <a class="header-anchor" href="#error-codes" aria-label="Permalink to “Error Codes”">​</a></h2><p>Canonical errors implemented across patterns.</p><table tabindex="0"><thead><tr><th>Code</th><th>Pattern</th><th>Meaning</th><th>Retryable</th><th>Hint</th></tr></thead><tbody><tr><td><code>RESOURCE_EXHAUSTED</code></td><td>flow-control</td><td>Queue full / backpressure</td><td>yes</td><td>send <code>retryAfterMs</code> in response</td></tr><tr><td><code>SEQUENCE_GAP</code></td><td>state-channels</td><td>Received seq &gt; expected</td><td>yes</td><td>request catch-up from gap point</td></tr><tr><td><code>REVISION_GAP</code></td><td>delta-sync</td><td>Client rev too far behind</td><td>yes</td><td>send snapshot; include <code>bufferFirstRev</code></td></tr></tbody></table><h2 id="conformance" tabindex="-1">Conformance <a class="header-anchor" href="#conformance" aria-label="Permalink to “Conformance”">​</a></h2><p>All fixtures MUST:</p><ul><li>Declare <code>schemaVersion</code> and <code>fixtureVersion</code></li><li>Include an <code>assertions</code> array (structure validated; runtime content optional)</li><li>Be sorted by number (e.g., <code>001-*.json</code>, <code>002-*.json</code>)</li></ul><p>Collectively, fixtures for a pattern SHOULD cover:</p><ul><li>Happy path / normal operation (e.g., <code>001-*.json</code>)</li><li>At least one documented failure scenario (e.g., <code>002-*.json</code>, <code>003-*.json</code>)</li></ul>',19)])])}const f=t(a,[["render",n]]);export{h as __pageData,f as default};
