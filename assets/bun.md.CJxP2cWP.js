import{x as i,b as e,i as a,p as n}from"./chunks/framework.Dl5MHC_T.js";const c=JSON.parse('{"title":"Bun v1.3.3 Features Relevant to WS-Kit","description":"","frontmatter":{},"headers":[],"relativePath":"bun.md","filePath":"bun.md","lastUpdated":1764286720000}'),t={name:"bun.md"};function l(h,s,r,p,k,o){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="bun-v1-3-3-features-relevant-to-ws-kit" tabindex="-1">Bun v1.3.3 Features Relevant to WS-Kit <a class="header-anchor" href="#bun-v1-3-3-features-relevant-to-ws-kit" aria-label="Permalink to “Bun v1.3.3 Features Relevant to WS-Kit”">​</a></h1><h2 id="websocket-serverwebsocket-subscriptions-getter" tabindex="-1">WebSocket: <code>ServerWebSocket.subscriptions</code> Getter <a class="header-anchor" href="#websocket-serverwebsocket-subscriptions-getter" aria-label="Permalink to “WebSocket: ServerWebSocket.subscriptions Getter”">​</a></h2><p><strong>Relevance</strong>: Pub/sub debugging and resource management</p><p>Access deduplicated list of topics a connection is subscribed to:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">router.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(someMessage, (</span><span style="--shiki-light:#E36209;--shiki-dark:#FFAB70;">ctx</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  const</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> topics</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> =</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ctx.ws.subscriptions; </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// New getter in v1.3.3</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  console.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">log</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">\`Client subscribed to: \${</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">topics</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">join</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;, &quot;</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">)</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">}\`</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Use cases:</p><ul><li>Debug topic subscriptions per connection</li><li>Validate subscription state</li><li>Cleanup and resource tracking</li></ul><hr><h2 id="testing-flake-control-with-retry-repeats" tabindex="-1">Testing: Flake Control with <code>retry</code>/<code>repeats</code> <a class="header-anchor" href="#testing-flake-control-with-retry-repeats" aria-label="Permalink to “Testing: Flake Control with retry/repeats”">​</a></h2><p><strong>Relevance</strong>: Stabilize timing-sensitive e2e/integration suites</p><p>Use Bun&#39;s built-in flake controls instead of ad-hoc loops:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { test } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bun:test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;debounced broadcast&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, runScenario, { retry: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">2</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// pass on first success</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;idempotent reconnect&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, runScenario, { repeats: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">10</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }); </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// fail on first miss</span></span></code></pre></div><p>Use cases:</p><ul><li>Cushion rare timing flakes (network, Worker startup) without hiding real failures</li><li>Prove determinism of reconnection/subscription flows by running them multiple times</li></ul><hr><h2 id="testing-ontestfinished-hook" tabindex="-1">Testing: <code>onTestFinished</code> Hook <a class="header-anchor" href="#testing-ontestfinished-hook" aria-label="Permalink to “Testing: onTestFinished Hook”">​</a></h2><p><strong>Relevance</strong>: Advanced test lifecycle and final cleanup</p><blockquote><p><strong>LLM tip</strong>: Use <code>afterEach</code> for per-test teardown of objects created in each <code>it</code>. Use <code>onTestFinished</code> only when you truly need a final, suite-level callback (e.g., leak assertions) and remember it must be registered inside a running test or hook—never at top-level.</p></blockquote><p>New hook executes after all <code>afterEach</code> hooks:</p><div class="language-typescript"><button title="Copy Code" class="copy"></button><span class="lang">typescript</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">import</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> { describe, test, afterEach, onTestFinished } </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">from</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;bun:test&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">describe</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;WebSocket Router&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  afterEach</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Per-test cleanup</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  onTestFinished</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(() </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Final cleanup after all tests in suite</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // Perfect for shared resources like mock servers</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">  test</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;handler&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, () </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">=&gt;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">    // ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  });</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">});</span></span></code></pre></div><p>Use cases:</p><ul><li>Final teardown of shared test fixtures</li><li>Global mock server cleanup</li><li>Resource allocation tracking</li></ul><hr><h2 id="environment-disable-implicit-env-loading" tabindex="-1">Environment: Disable Implicit <code>.env</code> Loading <a class="header-anchor" href="#environment-disable-implicit-env-loading" aria-label="Permalink to “Environment: Disable Implicit .env Loading”">​</a></h2><p><strong>Relevance</strong>: Deterministic CI runs and reproducible examples</p><p>Avoid leaking local <code>.env</code> into tests or example servers:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> test</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-env-file</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --no-env-file</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> examples/bun/server.ts</span></span></code></pre></div><p>Set <code>env = false</code> in <code>bunfig.toml</code> if you want this as the default.</p><hr><h2 id="performance-cpu-profiling-with-cpu-prof" tabindex="-1">Performance: CPU Profiling with <code>--cpu-prof</code> <a class="header-anchor" href="#performance-cpu-profiling-with-cpu-prof" aria-label="Permalink to “Performance: CPU Profiling with --cpu-prof”">​</a></h2><p><strong>Relevance</strong>: Performance bottleneck analysis</p><p>Generate Chrome DevTools–compatible profiles:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.ts</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">bun</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof-name=my-profile</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --cpu-prof-dir=./profiles</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> server.ts</span></span></code></pre></div><p>Output: <code>.cpuprofile</code> file, inspect in Chrome DevTools (DevTools → Performance → Load)</p><p>Use cases:</p><ul><li>Profile broadcast performance</li><li>Identify handler bottlenecks</li><li>Benchmark adapter efficiency</li></ul><hr><h2 id="lockfiles-configversion-stabilization" tabindex="-1">Lockfiles: <code>configVersion</code> Stabilization <a class="header-anchor" href="#lockfiles-configversion-stabilization" aria-label="Permalink to “Lockfiles: configVersion Stabilization”">​</a></h2><p><strong>Relevance</strong>: Monorepo stability and version control</p><p>Lockfiles now track configuration versions, preventing future Bun defaults from breaking builds. Re-run <code>bun install</code> after upgrading Bun to stabilize.</p><p>Use in CI: Lock Bun version + regenerate lockfile when upgrading.</p><hr><h2 id="references" tabindex="-1">References <a class="header-anchor" href="#references" aria-label="Permalink to “References”">​</a></h2><ul><li><a href="https://bun.com/blog/release-notes/bun-v1.3.3" target="_blank" rel="noreferrer">Bun v1.3.3 Release Notes</a></li></ul>`,44)])])}const g=i(t,[["render",l]]);export{c as __pageData,g as default};
